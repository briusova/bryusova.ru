import{computed as e,toValue as t,shallowRef as o,watch as n,reactive as l,getCurrentInstance as r,onMounted as i,unref as s,defineComponent as u,ref as a,onUnmounted as c,createElementBlock as v,openBlock as d,Fragment as f,renderList as m,normalizeClass as p,createBlock as h,resolveDynamicComponent as g}from"vue";import{u as b,p as w}from"./shared-aEZiy6lt.js";import{t as M,n as E,a as y,b as S,c as x,i as _,w as O,d as L,u as j,e as T,f as V,p as $,m as I,r as P,g as k,s as D,h as H,_ as W}from"./index-BBpH3mOy.js";import{useRoute as z,useRouter as A}from"vue-router";import"./unocss-Bk83BPCg.js";import"@vuebro/loader-sfc";const B=_?window:void 0;function C(e){var o;const n=t(e);return null!=(o=null==n?void 0:n.$el)?o:n}function X(...o){const n=[],l=()=>{n.forEach(e=>e()),n.length=0},r=e(()=>{const e=M(t(o[0])).filter(e=>null!=e);return e.every(e=>"string"!=typeof e)?e:void 0}),i=O(()=>{var e,n;return[null!=(n=null==(e=r.value)?void 0:e.map(e=>C(e)))?n:[B].filter(e=>null!=e),M(t(r.value?o[1]:o[0])),M(s(r.value?o[2]:o[1])),t(r.value?o[3]:o[2])]},([e,t,o,r])=>{if(l(),!(null==e?void 0:e.length)||!(null==t?void 0:t.length)||!(null==o?void 0:o.length))return;const i=L(r)?{...r}:r;n.push(...e.flatMap(e=>t.flatMap(t=>o.map(o=>((e,t,o,n)=>(e.addEventListener(t,o,n),()=>e.removeEventListener(t,o,n)))(e,t,o,i)))))},{flush:"post"});return S(l),()=>{i(),l()}}function Y(){const e=o(!1),t=r();return t&&i(()=>{e.value=!0},t),e}function q(t){const o=Y();return e(()=>(o.value,Boolean(t())))}function F(r,i={}){const{throttle:s=0,idle:u=200,onStop:a=y,onScroll:c=y,offset:v={left:0,right:0,top:0,bottom:0},observe:d={mutation:!1},eventListenerOptions:f={capture:!1,passive:!0},behavior:m="auto",window:p=B,onError:h=e=>{console.error(e)}}=i,g="boolean"==typeof d?{mutation:d}:d,b=o(0),w=o(0),_=e({get:()=>b.value,set(e){L(e,void 0)}}),O=e({get:()=>w.value,set(e){L(void 0,e)}});function L(e,o){var n,l,i,s;if(!p)return;const u=t(r);if(!u)return;null==(i=u instanceof Document?p.document.body:u)||i.scrollTo({top:null!=(n=t(o))?n:O.value,left:null!=(l=t(e))?l:_.value,behavior:t(m)});const a=(null==(s=null==u?void 0:u.document)?void 0:s.documentElement)||(null==u?void 0:u.documentElement)||u;null!=_&&(b.value=a.scrollLeft),null!=O&&(w.value=a.scrollTop)}const V=o(!1),$=l({left:!0,right:!1,top:!0,bottom:!1}),I=l({left:!1,right:!1,top:!1,bottom:!1}),P=e=>{V.value&&(V.value=!1,I.left=!1,I.right=!1,I.top=!1,I.bottom=!1,a(e))},k=T(P,s+u),D=e=>{var t;if(!p)return;const o=(null==(t=null==e?void 0:e.document)?void 0:t.documentElement)||(null==e?void 0:e.documentElement)||C(e),{display:n,flexDirection:l,direction:r}=getComputedStyle(o),i="rtl"===r?-1:1,s=o.scrollLeft;I.left=s<b.value,I.right=s>b.value;const u=Math.abs(s*i)<=(v.left||0),a=Math.abs(s*i)+o.clientWidth>=o.scrollWidth-(v.right||0)-1;"flex"===n&&"row-reverse"===l?($.left=a,$.right=u):($.left=u,$.right=a),b.value=s;let c=o.scrollTop;e!==p.document||c||(c=p.document.body.scrollTop),I.top=c<w.value,I.bottom=c>w.value;const d=Math.abs(c)<=(v.top||0),f=Math.abs(c)+o.clientHeight>=o.scrollHeight-(v.bottom||0)-1;"flex"===n&&"column-reverse"===l?($.top=f,$.bottom=d):($.top=d,$.bottom=f),w.value=c},H=e=>{var t;if(!p)return;const o=null!=(t=e.target.documentElement)?t:e.target;D(o),V.value=!0,k(e),c(e)};return X(r,"scroll",s?j(H,s,!0,!1):H,f),x(()=>{try{const e=t(r);if(!e)return;D(e)}catch(e){h(e)}}),(null==g?void 0:g.mutation)&&null!=r&&r!==p&&r!==document&&function(o,l,r={}){const{window:i=B,...s}=r;let u;const a=q(()=>i&&"MutationObserver"in i),c=()=>{u&&(u.disconnect(),u=void 0)},v=e(()=>{const e=t(o),n=M(e).map(C).filter(E);return new Set(n)}),d=n(v,e=>{c(),a.value&&e.size&&(u=new MutationObserver(l),e.forEach(e=>u.observe(e,s)))},{immediate:!0,flush:"post"}),f=()=>{d(),c()};S(f)}(r,()=>{const e=t(r);e&&D(e)},{attributes:!0,childList:!0,subtree:!0}),X(r,"scrollend",P,f),{x:_,y:O,isScrolling:V,arrivedState:$,directions:I,measure(){const e=t(r);p&&e&&D(e)}}}const G=["id","role"];const J=W(u({__name:"PageView",setup(l,{expose:r}){r();const i=a([]),s=z(),u=A(),v=e(()=>V.value?.siblings??[]),d=[],f=e(()=>v.value.filter(({enabled:e})=>e)),m=()=>{d.forEach(e=>{e()}),d.length=0},p=e(()=>void 0===V.value||V.value.parent?.flat?f.value:[V.value]),h=e(()=>new Map(p.value.map(({id:e=b()})=>[e,!1]))),g=a(new Map(h.value)),x=e(()=>{const[[e,t]=[]]=$;return $.clear(),e&&t&&$.set(e,t),Object.fromEntries(p.value.map(e=>[e.id,I(e)]))});n(i,l=>{m(),setTimeout(()=>{l.forEach(l=>{const{stop:r}=function(l,r,i={}){const{root:s,rootMargin:u="0px",threshold:a=0,window:c=B,immediate:v=!0}=i,d=q(()=>c&&"IntersectionObserver"in c),f=e(()=>{const e=t(l);return M(e).map(C).filter(E)});let m=y;const p=o(v),h=d.value?n(()=>[f.value,C(s),p.value],([e,t])=>{if(m(),!p.value)return;if(!e.length)return;const o=new IntersectionObserver(r,{root:C(t),rootMargin:u,threshold:a});e.forEach(e=>e&&o.observe(e)),m=()=>{o.disconnect(),m=y}},{immediate:v,flush:"post"}):y,g=()=>{m(),h(),p.value=!1};return S(g),{isSupported:d,isActive:p,pause(){m(),p.value=!1},resume(){p.value=!0},stop:g}}(l,([{isIntersecting:e,target:{id:t}={}}={}]=[])=>{g.value=new Map(h.value),t&&void 0!==e&&h.value.set(t,e)},{threshold:.1});d.push(r)})})},{deep:!0}),F(window,{behavior:"smooth",onStop:()=>{if(!k.value){const{scrollX:e,scrollY:t}=window,[o]=p.value,[n]=w.value;if(n&&o){const{$children:[{id:l}={}]=[]}=n,r=Math.floor(e)||Math.floor(t)||o.id!==l?[...h.value.entries()].find(([,e])=>e)?.[0]??[...g.value.entries()].find(([,e])=>e)?.[0]??o.id:n.id;r!==s.name&&(D.value=!1,u.push({name:r}).catch(H.error))}}}}),c(m);const _={refs:i,route:s,router:u,siblings:v,stops:d,$siblings:f,clearStops:m,these:p,intersecting:h,$intersecting:g,templates:x,get uid(){return b},get resolve(){return P},get that(){return V}};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),[["render",function(e,t,o,n,l,r){return d(!0),v(f,null,m(n.these,e=>(d(),v("div",{id:e.id??n.uid(),key:e.id??n.uid(),ref_for:!0,ref:"refs",class:p(e.class),role:e.id===n.that?.id?"main":"section","un-cloak":""},[(d(),h(g(n.templates[e.id]),{pid:e.id,onVnodeMounted:t=>n.resolve(e)},null,8,["pid","onVnodeMounted"]))],10,G))),128)}],["__file","PageView.vue"]]);export{J as default};
