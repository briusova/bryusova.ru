import{computed as M,toValue as m,shallowRef as W,watch as j,reactive as K,getCurrentInstance as se,onMounted as re,unref as I,defineComponent as ue,ref as Q,onUnmounted as ie,createElementBlock as Z,openBlock as F,Fragment as ae,renderList as ce,normalizeClass as fe,createBlock as de,resolveDynamicComponent as ve}from"vue";import{u as P,p as pe}from"./shared-D0i9xbrj.js";import{t as A,n as oe,a as H,b as z,c as me,i as he,w as be,d as ge,u as Ee,e as Me,f as x,p as X,m as we,r as _e,g as Se,s as ye,h as Oe}from"./index-BQzHiAbK.js";import{useRoute as Te,useRouter as Le}from"vue-router";import"./unocss-B_Rh5TB7.js";import"@vuebro/loader-sfc";const B=he?window:void 0;function C(t){var a;const c=m(t);return(a=c?.$el)!=null?a:c}function ee(...t){const a=[],c=()=>{a.forEach(n=>n()),a.length=0},w=(n,l,i,s)=>(n.addEventListener(l,i,s),()=>n.removeEventListener(l,i,s)),h=M(()=>{const n=A(m(t[0])).filter(l=>l!=null);return n.every(l=>typeof l!="string")?n:void 0}),f=be(()=>{var n,l;return[(l=(n=h.value)==null?void 0:n.map(i=>C(i)))!=null?l:[B].filter(i=>i!=null),A(m(h.value?t[1]:t[0])),A(I(h.value?t[2]:t[1])),m(h.value?t[3]:t[2])]},([n,l,i,s])=>{if(c(),!n?.length||!l?.length||!i?.length)return;const d=ge(s)?{...s}:s;a.push(...n.flatMap(r=>l.flatMap(u=>i.map(o=>w(r,u,o,d)))))},{flush:"post"}),v=()=>{f(),c()};return z(c),v}function ke(){const t=W(!1),a=se();return a&&re(()=>{t.value=!0},a),t}function ne(t){const a=ke();return M(()=>(a.value,!!t()))}function Ce(t,a,c={}){const{window:w=B,...h}=c;let f;const v=ne(()=>w&&"MutationObserver"in w),n=()=>{f&&(f.disconnect(),f=void 0)},l=M(()=>{const r=m(t),u=A(r).map(C).filter(oe);return new Set(u)}),i=j(l,r=>{n(),v.value&&r.size&&(f=new MutationObserver(a),r.forEach(u=>f.observe(u,h)))},{immediate:!0,flush:"post"}),s=()=>f?.takeRecords(),d=()=>{i(),n()};return z(d),{isSupported:v,stop:d,takeRecords:s}}function De(t,a,c={}){const{root:w,rootMargin:h="0px",threshold:f=0,window:v=B,immediate:n=!0}=c,l=ne(()=>v&&"IntersectionObserver"in v),i=M(()=>{const o=m(t);return A(o).map(C).filter(oe)});let s=H;const d=W(n),r=l.value?j(()=>[i.value,C(w),d.value],([o,p])=>{if(s(),!d.value||!o.length)return;const g=new IntersectionObserver(a,{root:C(p),rootMargin:h,threshold:f});o.forEach(y=>y&&g.observe(y)),s=()=>{g.disconnect(),s=H}},{immediate:n,flush:"post"}):H,u=()=>{s(),r(),d.value=!1};return z(u),{isSupported:l,isActive:d,pause(){s(),d.value=!1},resume(){d.value=!0},stop:u}}const te=1;function Re(t,a={}){const{throttle:c=0,idle:w=200,onStop:h=H,onScroll:f=H,offset:v={left:0,right:0,top:0,bottom:0},observe:n={mutation:!1},eventListenerOptions:l={capture:!1,passive:!0},behavior:i="auto",window:s=B,onError:d=e=>{console.error(e)}}=a,r=typeof n=="boolean"?{mutation:n}:n,u=W(0),o=W(0),p=M({get(){return u.value},set(e){y(e,void 0)}}),g=M({get(){return o.value},set(e){y(void 0,e)}});function y(e,L){var b,D,R,$;if(!s)return;const E=m(t);if(!E)return;(R=E instanceof Document?s.document.body:E)==null||R.scrollTo({top:(b=m(L))!=null?b:g.value,left:(D=m(e))!=null?D:p.value,behavior:m(i)});const T=(($=E?.document)==null?void 0:$.documentElement)||E?.documentElement||E;p!=null&&(u.value=T.scrollLeft),g!=null&&(o.value=T.scrollTop)}const O=W(!1),_=K({left:!0,right:!1,top:!0,bottom:!1}),S=K({left:!1,right:!1,top:!1,bottom:!1}),Y=e=>{O.value&&(O.value=!1,S.left=!1,S.right=!1,S.top=!1,S.bottom=!1,h(e))},le=Me(Y,c+w),V=e=>{var L;if(!s)return;const b=((L=e?.document)==null?void 0:L.documentElement)||e?.documentElement||C(e),{display:D,flexDirection:R,direction:$}=getComputedStyle(b),E=$==="rtl"?-1:1,T=b.scrollLeft;S.left=T<u.value,S.right=T>u.value;const U=Math.abs(T*E)<=(v.left||0),q=Math.abs(T*E)+b.clientWidth>=b.scrollWidth-(v.right||0)-te;D==="flex"&&R==="row-reverse"?(_.left=q,_.right=U):(_.left=U,_.right=q),u.value=T;let k=b.scrollTop;e===s.document&&!k&&(k=s.document.body.scrollTop),S.top=k<o.value,S.bottom=k>o.value;const G=Math.abs(k)<=(v.top||0),J=Math.abs(k)+b.clientHeight>=b.scrollHeight-(v.bottom||0)-te;D==="flex"&&R==="column-reverse"?(_.top=J,_.bottom=G):(_.top=G,_.bottom=J),o.value=k},N=e=>{var L;if(!s)return;const b=(L=e.target.documentElement)!=null?L:e.target;V(b),O.value=!0,le(e),f(e)};return ee(t,"scroll",c?Ee(N,c,!0,!1):N,l),me(()=>{try{const e=m(t);if(!e)return;V(e)}catch(e){d(e)}}),r?.mutation&&t!=null&&t!==s&&t!==document&&Ce(t,()=>{const e=m(t);e&&V(e)},{attributes:!0,childList:!0,subtree:!0}),ee(t,"scrollend",Y,l),{x:p,y:g,isScrolling:O,arrivedState:_,directions:S,measure(){const e=m(t);s&&e&&V(e)}}}const xe=["id","role"],Be=ue({__name:"PageView",setup(t){const a=Q([]),c=Te(),w=Le(),h=M(()=>x.value?.siblings??[]),f=[],v=M(()=>h.value.filter(({enabled:r})=>r)),n=()=>{f.forEach(r=>{r()}),f.length=0},l=M(()=>x.value===void 0||x.value.parent?.flat?v.value:[x.value]),i=M(()=>new Map(l.value.map(({id:r=P()})=>[r,!1]))),s=Q(new Map(i.value)),d=M(()=>{const[[r,u]=[]]=X;return X.clear(),r&&u&&X.set(r,u),Object.fromEntries(l.value.map(o=>[o.id,we(o)]))});return j(a,r=>{n(),setTimeout(()=>{r.forEach(u=>{const{stop:o}=De(u,([{isIntersecting:p,target:{id:g}={}}={}]=[])=>{s.value=new Map(i.value),g&&p!==void 0&&i.value.set(g,p)},{threshold:.1});f.push(o)})})},{deep:!0}),Re(window,{behavior:"smooth",onStop:()=>{if(!Se.value){const{scrollX:r,scrollY:u}=window,[o]=l.value,[p]=pe.value;if(p&&o){const{$children:[{id:g}={}]=[]}=p,y=!Math.floor(r)&&!Math.floor(u)&&o.id===g?p.id:[...i.value.entries()].find(([,O])=>O)?.[0]??[...s.value.entries()].find(([,O])=>O)?.[0]??o.id;y!==c.name&&(ye.value=!1,w.push({name:y}).catch(Oe.error))}}}}),ie(n),(r,u)=>(F(!0),Z(ae,null,ce(l.value,o=>(F(),Z("div",{id:o.id??I(P)(),key:o.id??I(P)(),ref_for:!0,ref_key:"refs",ref:a,class:fe(o.class),role:o.id===I(x)?.id?"main":"section","un-cloak":""},[(F(),de(ve(d.value[o.id]),{pid:o.id,onVnodeMounted:p=>I(_e)(o)},null,8,["pid","onVnodeMounted"]))],10,xe))),128))}});export{Be as default};
